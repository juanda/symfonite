var app={zindex:0,colors:{yellow:1,blue:2,green:3,red:4},init:function(){$("#add").click(app.add);$("#del").click(app.del);$("#arrange").click(app.arrange);$("#save").click(app.save);$(window).resize(function(){if($(window).width()<=600){app.arrange()}});if(localStorage["playsticky.data"]!==null){$("#content").html(localStorage["playsticky.data"]);$("#content").find("header li:nth-child(-n+4)").children("a").click(app.color);$("#content").find("header li:nth-child(5)").children("a").click(app.close);if(localStorage["playsticky.zindex"]!==null){app.zindex=localStorage["playsticky.zindex"]}}app.selectable($("nav"),false);app.enableDrag()},save:function(){$("textarea").each(function(){$(this).html($(this).val())});localStorage["playsticky.data"]=$("#content").html();localStorage["playsticky.zindex"]=app.zindex;$("#status").fadeIn("slow").delay(3000).fadeOut("slow")},del:function(){if(confirm("Are you sure you want to delete all the stickies?")){$("#content").empty();app.zindex=0}},add:function(){var a=$('<article><header><ul class=tools><li><a href=# class=yellow title="set color to yellow"><span>yellow</span></a></li><li><a href=# class=blue title="set color to blue"><span>blue</span></a></li><li><a href=# class=green title="set color to green"><span>green</span></a></li><li><a href=# class=red title="set color to red"><span>red</span></a></li><li><a href=# class=close title="close note"><span>close</span></a></li></ul></header><textarea maxlength=160>Type here</textarea></article>');$(a.find("li:nth-child(-n+4)").children("a").click(app.color)[Math.floor(Math.random()*4)]).trigger("click");a.find("li:nth-child(5)").children("a").click(app.close);$("#content").prepend(a)},close:function(){if(confirm("Are you sure you want to close the sticky?")){$(this).parents().eq(3).fadeOut("slow",function(){$(this).remove()})}return false},color:function(){var a=$(this),b=a.parent().next().children("a");a.parents().eq(1).find("a").removeClass("next");a.parents().eq(3).attr("class",a.attr("class"));if(b.hasClass("close")){b=a.parents().eq(1).children(":first").children("a")}b.addClass("next");return false},arrange:function(){$("#content").remove("article").append($("#content").children().css("position","static").css("left","auto").css("top","auto").get().sort(function(d,c){return(app.colors[$(d).attr("class")]>=app.colors[$(c).attr("class")]?1:-1)}))},enableDrag:function(){var b=$(document),a=function(d){if(b.data("mouseMove")){var c=b.data("target");c.css("left",parseInt(c.css("left"),10)+d.pageX-b.data("x")).css("top",parseInt(c.css("top"),10)+d.pageY-b.data("y"));b.data("x",d.pageX).data("y",d.pageY)}};b.mousedown(function(f){var d=f.target.tagName.toLowerCase(),c=$(f.target).parent();if(d=="textarea"){$(f.target).parent().css("z-index",++app.zindex)}else{if(d=="header"){c.addClass("drag");c.css("z-index",++app.zindex);if(c.css("position")!="absolute"){c.css("left",c.offset().left).css("top",c.offset().top).css("position","absolute")}b.data("mouseMove",true).data("x",f.pageX).data("y",f.pageY).data("target",c);app.selectable($("article"),false)}}});b.mouseup(function(){if(b.data("mouseMove")){b.data("target").removeClass("drag");b.data("mouseMove",false).data("target",null);app.selectable($("article"),true)}});b.mousemove(a)},selectable:function(a,b){if(!a){return}a.unselectable=b?"off":"on";a.onselectstart=function(){return b};a.css("-webkit-user-select",b?"":"none");a.css("-moz-user-select",b?"":"none")}};$(document).ready(function(){if(!(("localStorage" in window)&&window.localStorage!==null)){alert("Your browser does not support HTML5 local storage. Try upgrading.")}else{app.init()}});
